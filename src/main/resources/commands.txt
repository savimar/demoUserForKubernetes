 
 minikube start 
 
 minikube addons enable ingress 

 helm repo add bitnami https://charts.bitnami.com/bitnami

 helm repo update
 
 kubectl create ns app

 kubectl config set-context --current --namespace=app


 cd C:\Users\Maria\IdeaProjects\demoUserForKubernetes\src\main\resources\db_yaml
 
 kubectl apply -f user-config.yaml  
 
 helm install postrgedb bitnami/postgresql -f values.yaml 

  kubectl delete -A ValidatingWebhookConfiguration ingress-nginx-admission 

  kubectl apply -f C:\Users\Maria\IdeaProjects\demoUserForKubernetes\src\main\resources
 
 kubectl get all  (ждем когда поднимутся поды)
 
 (проверка данных в БД)
 psql -h  192.168.99.101 -p 31725 -U postgres -W users (port NodePort service/pg, host - minikube ip)
 Пароль: root
 select * from users;

 \q

 kubectl logs pod/savimar-deployment-6889bb7d56-5jkxf
 

  
  kubectl get all --all-namespaces   
  
  kubectl get ingress --all-namespaces   

   kubectl describe pod/pg-0
 

     kubectl delete deployment.apps/savimar-deployment


  


 helm repo add prometheus-community https://prometheus-community.github.io/helm-charts

  helm repo add stable https://charts.helm.sh/stable

 helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx

 helm repo update


 cd C:\Users\Maria\IdeaProjects\demoUserForKubernetes\src\main\resources\metrics
  

 kubectl create namespace monitoring

  kubectl config set-context --current --namespace=monitoring


 helm install -n monitoring prom prometheus-community/kube-prometheus-stack -f prometheus.yaml --atomic

  kubectl config set-context --current --namespace=default

 kubectl apply -f servicemonitor.yaml   --validate=false

 kubectl get servicemonitor --all-namespaces
 
 #helm install  nginx ingress-nginx/ingress-nginx -f nginx-ingress.yaml --atomic


 
 
  kubectl port-forward service/prom-kube-prometheus-stack-prometheus 9090
  
    kubectl port-forward service/prom-grafana 9000:80


  

  while 1; do ab -n 50 -c 5 http://192.168.99.100:30259/db ; sleep 3; 

  cd f:/ab/Apache24/bin
  .\ab -n 50 -c 5 http://192.168.99.100:32449/db/
  .\ab -n 50 -c 5 http://192.168.99.100:30259/

   .\ab -n 10000 -c 50 -t 3  -r -t 3000 http://192.168.99.100:30172/
 
 
 rpc sum(rate(http_server_requests_seconds_count{pod="savimar-deployment-5796ffb6b4-nclgz"}[2m]))
 latency histogram_quantile(0.9, sum by (le) (rate(http_server_requests_seconds_bucket{pod="savimar-deployment-5796ffb6b4-nclgz"}[5m])))

 

 500  sum by (status) (increase(http_server_requests_seconds_count{pod="savimar-deployment-5796ffb6b4-nclgz", status=~"5.+"}[1m]))
